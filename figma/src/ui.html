<!-- loading style -->
<link href="./loading.css" rel="stylesheet" />

<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link
  href="https://fonts.googleapis.com/css?family=Roboto:400,100,300,100italic,300italic,400italic,500italic,500,700,700italic,900,900italic"
  rel="stylesheet"
  type="text/css"
/>
<link
  href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@300;400&display=swap"
  rel="stylesheet"
/>

<!-- preconnection to warm up connection -->
<link rel="dns-prefetch" href="https://assistant-serve.grida.co/" />
<link rel="preconnect" href="https://assistant-serve.grida.co/init-figma" />
<link rel="preload" href="https://assistant-serve.grida.co/init-figma" />

<style>
  /* override ua stylesheet - figma lite is just a wrapper of web, it should not have any styles. */
  body {
    margin: 0px;
  }
  #resize-knob {
    position: fixed;
    right: 1px;
    bottom: 2px;
    cursor: nwse-resize;
  }

  .baseBox {
    background-color: #dbdbdb;
    position: relative;
    border-radius: 2px;
  }

  @keyframes shine {
    0% {
      transform: skewX(-1deg) translateX(-200%);
    }
    100% {
      transform: skewX(-10deg) translateX(180%);
    }
  }
  .baseBox::before {
    content: "";
    position: absolute;
    background: linear-gradient(
      90deg,
      transparent,
      rgba(255, 255, 255, 0.3),
      transparent
    );
    width: 50%;
    height: 100%;
    top: 0;
    left: 0;
    animation: shine 1s infinite;
  }

  .wrapper {
    z-index: 1;
    position: absolute;
    top: 0;
    bottom: 0;
    overflow: hidden;

    max-height: 100%;
    margin: 22px 16px;
  }
  .row {
    display: flex;
    flex-direction: row;
  }
  .nav {
    width: 54px;
    height: 21px !important;
  }
  .nav:first-child {
    margin-right: 8px;
  }
  .tabWrap {
    margin-top: 10px;
  }
  .tab {
    width: 54px;
    height: 13px !important;
    margin-right: 8px;
  }
  .tab:last-child {
    margin-right: 0;
  }

  .preview {
    width: 100vw;
    height: 200px !important;
    margin: 0 -16px;
    margin-top: 10px;
  }
  .column {
    display: flex;
    flex-direction: column;
  }

  .contentsWrap {
    margin-top: 10px;
  }
  .contents {
    width: 137px;
    height: 8px !important;
    margin-bottom: 4px;
  }
  .contents:last-child {
    margin-bottom: 0;
  }
  .button {
    width: calc(100vw - 32px);
    height: 48px !important;
    position: fixed;
    bottom: 12px;
    left: 16px;
  }
</style>
<div id="main">
  <div id="loader" class="wrapper">
    <div class="row">
      <div class="baseBox nav"></div>
      <div class="baseBox nav"></div>
    </div>
    <div class="row tabWrap">
      <div class="baseBox tab"></div>
      <div class="baseBox tab"></div>
    </div>
    <div class="baseBox preview"></div>
    <div class="column contentsWrap">
      <div class="baseBox contents"></div>
      <div class="baseBox contents"></div>
      <div class="baseBox contents"></div>
    </div>
    <div class="baseBox button"></div>
  </div>
  <iframe
    z-index="1"
    id="remote-host"
    width="100%"
    height="100%"
    sandbox="allow-scripts allow-same-origin allow-popups"
    frameborder="0"
    allowfullscreen
    src="<%= htmlWebpackPlugin.options.host %>/init-figma"
  ></iframe>
  <svg
    id="resize-knob"
    width="16"
    height="16"
    viewBox="0 0 16 16"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <path d="M16 0V16H0L16 0Z" fill="white" />
    <path d="M6.22577 16H3L16 3V6.22576L6.22577 16Z" fill="#8C8C8C" />
    <path
      d="M11.8602 16H8.63441L16 8.63441V11.8602L11.8602 16Z"
      fill="#8C8C8C"
    />
  </svg>
</div>
<script>
  const corner = document.getElementById("resize-knob");
  function resizeWindow(e) {
    const size = {
      w: Math.max(50, Math.floor(e.clientX + 5)),
      h: Math.max(50, Math.floor(e.clientY + 5)),
    };
    parent.postMessage({ pluginMessage: { type: "resize", size: size } }, "*");
  }
  corner.onpointerdown = (e) => {
    corner.onpointermove = resizeWindow;
    corner.setPointerCapture(e.pointerId);
  };
  corner.onpointerup = (e) => {
    corner.onpointermove = null;
    corner.releasePointerCapture(e.pointerId);
  };
</script>
<script>
  const frame = document.getElementById("remote-host");
  window.addEventListener("message", (event) => {
    // console.log("event recievd from lite-fima-app", event.data);
    if (event.data == "plugin-app-initialized") {
      // handle skeleton hide & initial load animation here.
      document.getElementById("loader").remove();
    }

    if ("pluginMessage" in event.data) {
      if (event.data.pluginMessage.__proxy_request_from_hosted_plugin) {
        handle(event.data.pluginMessage);
        return;
      }
      if (
        "pluginId" in event.data ||
        event.data.pluginMessage.type === "response"
      ) {
        frame.contentWindow.postMessage(event.data, "*");
      } else {
        parent.postMessage(
          {
            ...event.data,
            "message-transport": true,
          },
          "*"
        );
      }
    }
  });

  ///
  /// To optimize this package, we don't import any other dependency.
  /// but for a reference, please add import statement below with commented.
  ///
  /*import {*/
  /* TransportPluginEvent,*/
  /* PLUGIN_SDK_EK_BROWSER_OPEN_URI,*/
  /*} from "@plugin-sdk/core";*/
  function handleProxy(payload) {
    console.log("handling proxy request from hosted app.", payload);

    // PLUGIN_SDK_EK_BROWSER_OPEN_URI
    if (payload.key == "assistant/browser-api/open-uri") {
      open(payload.data.uri);
    }
  }
  ///
  ///
</script>
